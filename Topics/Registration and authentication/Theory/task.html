<h2>Registration and authentication</h2>
<div class="step-text">
<p> </p><p>To access the service's customization, users should have personal accounts so that they can perform actions related only to them: for example, save personal preferences, post articles, or make purchases.</p><p>If you are an active Internet user, you're probably familiar with the sign-up, login, and logout operations. Django provides the means to add those operations easily. In this topic, you will learn how to add registration and authentication to a service.</p><h5 id="user-model">User model</h5><p>To distinguish one user from another, we need to store their identification information on the server. On websites, it's usually a unique username or email address. Both characteristics may be stored in the default <code class="language-python">User</code> model.</p><p></p><div class="alert alert-primary"><p>To start working with the User model, run <code class="language-python">python manage.py migrate</code> from the root of your project. If you don't change any settings, you will have an SQLite database attached to your project.</p></div><p></p><p>After making the initial migrations, you can create new accounts. Typically, clients of your service will create their own accounts, but let's explore how you can manually create a regular user or a superuser in the database using the console.</p><p>A superuser is an administrative account for your service. As a superuser, you have access to and can manipulate any data in the database. Regular users, on the other hand, can only manipulate their own data.</p><p>To use an initialized console client, run <code class="language-python">python manage.py shell</code>  command.</p><pre><code class="language-python">from django.contrib.auth.models import User


User.objects.create_superuser(
   username='admin', email='admin@example.com', password='SeCreTPaSsWorD'
)

User.objects.create_user(
   username='usual_user', email='user@example.com', password='NotSecRetAtAll'
)</code></pre><p>As you may have guessed,  <code class="language-python">create_user</code> method creates a usual user and <code class="language-python">create_superuser</code> creates a superuser in your database. You're not likely to need the <code class="language-python">create_user</code> method often, but you will need a console method to make the first admin account.</p><p></p><div class="alert alert-primary"><p>Another way to create a superuser is with the <code class="language-python">python manage.py createsuperuser</code> command. You can read more about it in the <a href="https://docs.djangoproject.com/en/4.1/ref/django-admin/#createsuperuser" rel="noopener noreferrer nofollow" target="_blank">official Django documentation</a>.</p></div><p></p><p>Similar to <em>superuser</em>, Django also provides a user object called <strong><em>staff</em></strong>. A staff is a user in Django that has access to the admin panel but has no permission to create, delete or modify anything present on the panel. On the other hand, the superuser is the absolute administrator of any Django project and has full access to the model present on the admin panel.</p><p>So to sum up the user privileges:</p><ol><li><p>Normal users can only access the interface provided in the front end and cannot access the admin panel.</p></li><li><p>Staff users can access the admin panel. They can see the models but beyond this, they have no privilege. Some staff can be given the privilege to manage certain models which have to be defined explicitly.</p></li><li><p>Superuser has access to all the models and can change them freely without restrictions. A superuser is granted all the permissions in a Django project.</p></li></ol><h5 id="preparing-urls">Preparing URLs</h5><p>To separate each action, you should choose the URL addresses for login, logout, and signup operations. You should update the <code class="language-python">urlpatterns</code> variable in your main <em>urls.py</em> module.</p><p>To make it neat and clear, choose straightforward paths:</p><pre><code class="language-python">urlpatterns += [
    path('login', MyLoginView.as_view()),
    path('logout', LogoutView.as_view()),
    path('signup', MySignupView.as_view()),
]</code></pre><p>Now you need to implement several classes and import them to the <em>urls.py</em> module. Start by making <code class="language-python">MySignupView</code> class.</p><h5 id="signup">Signup</h5><p>You already know how you can create a new user with Python, but regular users don't know Python. We've got to provide a simple web interface for them with an HTML form. Fortunately, making it will only take us a few simple steps, and then your new users will just sign up on their own.</p><pre><code class="language-python">from django.contrib.auth.forms import UserCreationForm
from django.views.generic import CreateView


class MySignupView(CreateView):
    form_class = UserCreationForm
    success_url = 'login'
    template_name = 'signup.html'</code></pre><p>To be able to create objects with the HTTP handler, we inherit <code class="language-python">MySignupView</code> class from <code class="language-python">CreateView</code>. We define several attributes that will do the work for us:</p><ul><li><p>The <code class="language-python">form_class</code> attribute is a Django form class. We select <code class="language-python">UserCreationForm</code> from the framework to create a new user.</p></li><li><p>After our users finished registration, they are redirected to the <code class="language-python">success_url</code> page of the service, in our case, to the login page.</p></li><li><p><code class="language-python">template_name</code> is simply the name of a template responsible for the signup page of the service.</p></li></ul><p>We're almost there with preparing our registration form; just add a custom <em>signup.html</em> template and that's it.</p><pre><code class="language-django">&lt;form method="post" action="signup"&gt;{% csrf_token %}
  &lt;table&gt;{{ form.as_table }}&lt;/table&gt;
  &lt;button type="submit"&gt;Send&lt;/button&gt;
&lt;/form&gt;</code></pre><p></p><div class="alert alert-warning"><p>Do not forget to update <code class="language-python">settings.TEMPLATES.DIRS</code> and add the <em>signup.html</em> template's directory to it.</p></div><p></p><p>We make a simple form and add it to the template, which is enough for a quick start. The page is cluttered with hints, but it does the job well. Now we have a registration form for the service:</p><p style="text-align: center;"><picture><source media="(max-width: 480px)" srcset="https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/480x/-/format/webp/ 1x,https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/960x/-/format/webp/ 2x,https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/1440x/-/format/webp/ 3x" type="image/webp"/><source media="(max-width: 800px)" srcset="https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/800x/-/format/webp/ 1x,https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/1600x/-/format/webp/ 2x,https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/2400x/-/format/webp/ 3x" type="image/webp"/><source srcset="https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/1100x/-/format/webp/ 1x,https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/2200x/-/format/webp/ 2x,https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/-/stretch/off/-/resize/3000x/-/format/webp/ 3x" type="image/webp"/><img alt="Registration form" height="347" src="https://ucarecdn.com/7c33a964-4837-4c82-a715-2da2d030fbe7/" width="875"/></picture></p><h5 id="login">Login</h5><p>The process of creating a request handler for logging in is very similar to making a registration form. We define the class and specify the <code class="language-python">template_name</code> in it:</p><pre><code class="language-python">from django.contrib.auth.views import LoginView


class MyLoginView(LoginView):
    redirect_authenticated_user = True
    template_name = 'login.html'</code></pre><p>This time we add another attribute <code class="language-python">redirect_authenticated_user</code> and set it to <code class="language-python">True</code>. All authenticated users that come back to the <em>login</em> page will be redirected to the main site instead of having to fill the authentication form again.</p><p>To define where the user should be redirected after successful authentication, we set <code class="language-python">LOGIN_REDIRECT_URL = '/'</code> in the <em>settings.py</em> module. It's usually the main page of the service, but you can choose any page you like.</p><p>The <em>login.html</em> template differs from <em>signup.html</em> by the <code class="language-python">action</code> field and the label of the button:</p><pre><code class="language-django">&lt;form method="post" action="login"&gt;{% csrf_token %}
  &lt;table&gt;{{ form.as_table }}&lt;/table&gt;
  &lt;button type="submit"&gt;Login&lt;/button&gt;
&lt;/form&gt;</code></pre><p>The result is concise and pleasing:</p><p style="text-align: center;"><picture><source media="(max-width: 480px)" srcset="https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/480x/-/format/webp/ 1x,https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/960x/-/format/webp/ 2x,https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/1440x/-/format/webp/ 3x" type="image/webp"/><source media="(max-width: 800px)" srcset="https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/800x/-/format/webp/ 1x,https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/1600x/-/format/webp/ 2x,https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/2400x/-/format/webp/ 3x" type="image/webp"/><source srcset="https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/1100x/-/format/webp/ 1x,https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/2200x/-/format/webp/ 2x,https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/-/stretch/off/-/resize/3000x/-/format/webp/ 3x" type="image/webp"/><img alt="Authentication form" height="157" src="https://ucarecdn.com/5b12f5ad-4adf-4c73-b4e1-22c7050b63c3/" width="395"/></picture></p><h5 id="logout">Logout</h5><p>The last action our users need is logout. They do not need to send any information, so to log out they should just go to the right URL.</p><p>You can see that for login and signup we define our custom <code class="language-python">MySignupView</code> and <code class="language-python">MyLoginView</code> classes accordingly. In <code class="language-python">urlpatterns</code> you can find that for logout we use <code class="language-python">LogoutView</code> class from <em>django.contrib.auth.views</em> module. Just import it to the <em>urls.py</em> module to complete the work.</p><p>If you want to specify where the user should be redirected after logging out, you can define this in the <em>settings.py</em> module. For example, to redirect users back to the login page, add this line to the module: <code class="language-python">LOGOUT_REDIRECT_URL = '/login'</code>.</p><p>Now you know enough to add authentication to any service, so you can personalize your web service for each individual user.</p><h5 id="conclusion">Conclusion</h5><p>Now you are familiar with user registration and authentication. To summarize the entire topic:</p><ol><li><p>Django provides a user model of three permission levels: Normal user, Staff user and Super user</p></li><li><p>To register a new user, you can create an instance of the User model from django.contrib.auth.models.</p></li><li><p> For logging in, you need to authenticate a User.</p></li><li><p>Logging out is the simplest part of User-application interaction and the generic view can be used for the purpose.</p></li></ol>
</div>
